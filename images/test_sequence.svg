<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="569px" preserveAspectRatio="none" style="width:620px;height:569px;background:#FFFFFF;" version="1.1" viewBox="0 0 620 569" width="620px" zoomAndPan="magnify"><defs/><g><rect fill="none" height="27.6094" id="_title" style="stroke:none;stroke-width:1.0;" width="139.9375" x="239.5313" y="10"/><text fill="#000000" font-family="sans-serif" font-size="14" font-weight="bold" lengthAdjust="spacing" textLength="129.9375" x="244.5313" y="29.5332">微信公众号授权流程</text><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="22" x2="22" y1="121.2188" y2="487.0859"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="137" x2="137" y1="121.2188" y2="487.0859"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="266" x2="266" y1="121.2188" y2="487.0859"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="461" x2="461" y1="121.2188" y2="487.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="5" y="118.1426">用户</text><ellipse cx="22" cy="52.1094" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M22,60.1094 L22,87.1094 M9,68.1094 L35,68.1094 M22,87.1094 L9,102.1094 M22,87.1094 L35,102.1094 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="28" x="5" y="500.6191">用户</text><ellipse cx="22" cy="512.1953" fill="#E2E2F0" rx="8" ry="8" style="stroke:#181818;stroke-width:0.5;"/><path d="M22,520.1953 L22,547.1953 M9,528.1953 L35,528.1953 M22,547.1953 L9,562.1953 M22,547.1953 L35,562.1953 " fill="none" style="stroke:#181818;stroke-width:0.5;"/><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="95" y="88.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="102" y="110.1426">微信客户端</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="95" y="486.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="102" y="507.6191">微信客户端</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="224" y="88.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="231" y="110.1426">微信服务器</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="224" y="486.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="231" y="507.6191">微信服务器</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="419" y="88.6094"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="426" y="110.1426">系统服务器</text><rect fill="#E2E2F0" height="31.6094" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="84" x="419" y="486.0859"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="70" x="426" y="507.6191">系统服务器</text><polygon fill="#181818" points="125,149.5703,135,153.5703,125,157.5703,129,153.5703" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="22" x2="131" y1="153.5703" y2="153.5703"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="91" x="29" y="148.7139">点击公众号菜单</text><polygon fill="#181818" points="254,179.9219,264,183.9219,254,187.9219,258,183.9219" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="137" x2="260" y1="183.9219" y2="183.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="144" y="179.0654">携带redict_url请求</text><polygon fill="#181818" points="449,210.2734,459,214.2734,449,218.2734,453,214.2734" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="266" x2="455" y1="214.2734" y2="214.2734"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="171" x="273" y="209.417">请求回调接口(redict_url,code)</text><polygon fill="#181818" points="277,240.625,267,244.625,277,248.625,273,244.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="271" x2="460" y1="244.625" y2="244.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="283" y="239.7686">获取用户openid</text><polygon fill="#181818" points="449,270.9766,459,274.9766,449,278.9766,453,274.9766" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="266" x2="455" y1="274.9766" y2="274.9766"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="273" y="270.1201">openid, access_token</text><polygon fill="#181818" points="277,317.6797,267,321.6797,277,325.6797,273,321.6797" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="271" x2="460" y1="321.6797" y2="321.6797"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="104" x="283" y="300.4717">获取用户基本信息</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="130" x="283" y="316.8232">(nickname,headimg等)</text><line style="stroke:#181818;stroke-width:1.0;" x1="461" x2="503" y1="352.0313" y2="352.0313"/><line style="stroke:#181818;stroke-width:1.0;" x1="503" x2="503" y1="352.0313" y2="365.0313"/><line style="stroke:#181818;stroke-width:1.0;" x1="462" x2="503" y1="365.0313" y2="365.0313"/><polygon fill="#181818" points="472,361.0313,462,365.0313,472,369.0313,468,365.0313" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="145" x="468" y="347.1748">生成userid并写入session</text><line style="stroke:#181818;stroke-width:1.0;" x1="461" x2="503" y1="395.3828" y2="395.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="503" x2="503" y1="395.3828" y2="408.3828"/><line style="stroke:#181818;stroke-width:1.0;" x1="462" x2="503" y1="408.3828" y2="408.3828"/><polygon fill="#181818" points="472,404.3828,462,408.3828,472,412.3828,468,408.3828" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="105" x="468" y="390.5264">生成新的redict_url</text><polygon fill="#181818" points="148,434.7344,138,438.7344,148,442.7344,144,438.7344" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="142" x2="460" y1="438.7344" y2="438.7344"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="154" y="433.8779">跳转到新的redict_url</text><polygon fill="#181818" points="33,465.0859,23,469.0859,33,473.0859,29,469.0859" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="27" x2="136" y1="469.0859" y2="469.0859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="52" x="39" y="464.2295">进入系统</text><!--MD5=[cf88f46ba534e9e3c51ffb54238f695a]
@startuml
title: 微信公众号授权流程
' 测试时序图

actor 用户
participant 微信客户端
participant 微信服务器
participant 系统服务器

用户 -> 微信客户端: 点击公众号菜单
微信客户端 -> 微信服务器: 携带redict_url请求
微信服务器 -> 系统服务器: 请求回调接口(redict_url,code)
微信服务器 <- 系统服务器: 获取用户openid
微信服务器 - -> 系统服务器: openid, access_token
微信服务器 <- 系统服务器: 获取用户基本信息\n(nickname,headimg等)
系统服务器 -> 系统服务器: 生成userid并写入session
系统服务器 -> 系统服务器: 生成新的redict_url
微信客户端 <- 系统服务器: 跳转到新的redict_url
用户 <- 微信客户端: 进入系统
@enduml

@startuml
title: 微信公众号授权流程

actor 用户
participant 微信客户端
participant 微信服务器
participant 系统服务器

用户 -> 微信客户端: 点击公众号菜单
微信客户端 -> 微信服务器: 携带redict_url请求
微信服务器 -> 系统服务器: 请求回调接口(redict_url,code)
微信服务器 <- 系统服务器: 获取用户openid
微信服务器 - -> 系统服务器: openid, access_token
微信服务器 <- 系统服务器: 获取用户基本信息\n(nickname,headimg等)
系统服务器 -> 系统服务器: 生成userid并写入session
系统服务器 -> 系统服务器: 生成新的redict_url
微信客户端 <- 系统服务器: 跳转到新的redict_url
用户 <- 微信客户端: 进入系统
@enduml

PlantUML version 1.2022.7(Tue Aug 23 01:01:30 HKT 2022)
(GPL source distribution)
Java Runtime: Java(TM) SE Runtime Environment
JVM: Java HotSpot(TM) 64-Bit Server VM
Default Encoding: UTF-8
Language: zh
Country: CN
--></g></svg>